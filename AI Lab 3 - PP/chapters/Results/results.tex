\section{Results}

All models were trained on the full training dataset contained in \texttt{"smartbkg\_dataset\_4k\_training.parquet"}, 
using a $75 \% $-$25\%$ train-validation split. Training was conducted over 10 epochs using the Adam optimizer with a weight decay of $10^{-4}$. Furthermore, the models were trained on Cartesian coordinates with features \texttt{"prodTime", "x", "y", "z", "energy", "px", "py"}, and \texttt{"pz"}. 

Evaluation was performed on the full test dataset contained in \texttt{"smartbkg\_dataset\_4k\_testing.parquet"}, using a batch size of 256.

Table \ref{tab:train_validation_metrics} shows the validation loss and accuracy for every model presented in section \ref{sec:models}.
\begin{table}[h]
    \centering
    \caption{Train and validation metrics for every model}
    \label{tab:train_validation_metrics}
    \begin{tabular}{l|cc|cc}
    \hline
    & \multicolumn{2}{c|}{Train} & \multicolumn{2}{c}{Validation} \\
    \textbf{Model} & \textbf{Loss} & \textbf{Acc. (\%)} & \textbf{Loss} & \textbf{Acc. (\%)} \\
    \hline
    \texttt{deepset}& $0.629$&$64.0$&$0.633$&$63.6$\\
    \texttt{deepset\_combined}&$0.480$&$77.2$&$0.478$&$77.5$\\
    \texttt{deepset\_gcn}&$0.617$&$65.8$&$0.614$&$66.0$\\
    \texttt{deepset\_combined\_gcn}&$0.463$&$78.2$&$0.467$&$78.0$\\
    \texttt{transformer}&$0.446$&$79.2$&$0.443$&$79.4$\\
    \texttt{deepset\_combined\_gcn\_normalized}& $0.475$&$77.3$&$0.474$&$77.2$ \\
    \hline
    \end{tabular}
    \end{table}

Comparing the different models leads to the following conclusions: Incorporating  PDG IDs through learned embeddings improves performance by enrichting the particle representation. Similarly, adding GCN layers to the DeepSet architecture enhances performance by capturing structural information from particle relationships. Combining both techniques, embeddings and GCNs, yields furhter improvement. 

In contrast, normalizing the input features slightly reduces the performance
of the \texttt{deepset\_combined\_gcn} model by $0.8\%$ in validation accuracy. 
    
Among the implemented models, the Transformer currently achieves the highest accuracy at $79.4\%$. 

\subsection{Optimal model}

Section \ref{sec:methodology} explores various strategies for regularization, feature processing, and architectural design. Based on the insights gained, we combined the most effective components into a single architecture, referred to as the Optimal Model. 

The model builds upon a base architecture in which the input features are augmented with PDG ID embeddings, increasing the feature dimensionality by 25. The network consists of four sequential layers: the input layer, second, and third layer are implemented as GCNs, followed by one linear layer. THis is followed by mean pooling across particles and final two-layer MLP to produce the output. 

Each trainable layer is followed by Dropout (with a rate of $0.179$), a LeakyReLU activation (slope $0.01$), and Batch Normalization. Training was conducted using cylindrical coordinates, while all other settings remained consistent with previous experiments. 

\begin{table}[h]
    \caption{Architecture of the Optimal Model}
    \label{tab:transformer_arc}
    \centering
    \begin{tabular}{l|l|c|c}
        \hline
        Layer \# & Description & Output shape & Parameters \\
        \hline 
        1 & Embedding lookup (PDG code) & $[B,N,e]$ & $(n_\text{PDG} + 1) \times e $ \\
        -- & Concatenation of features and embeddings & $[B,N,f+e]$ & -- \\
        2 & GCN layer + BatchNorm, LeakyReLU, Dropout & $[B,N,u]$ & $u \times (f+e) + u$ \\
        3-4 & GCN layer + BatchNorm, LeakyReLU, Dropout & $[B,N,u]$ & $u \times u + u$ \\
        5 & Linear layer + BatchNorm, LeakyReLU, Dropout& $[B,N,u]$ & $u \times u + u$ \\
        --& Masked mean pooling (or mean over $N$)& $[B,u]$& -- \\
        6& Linear + BatchNorm, LeakyReLU, Dropout & $[B,u]$ & $u \times u + u$ \\ 
        7& Linear (output layer) & $[B,1]$ & $1 \times u + 1$ \\
        \hline
    \end{tabular}
\end{table}


\subsection{ROC curves and speedup results}

Figures~\ref{fig:ROC_curves_results} and~\ref{fig:speedup} present the ROC curves and speedup plots for our most promising models.  
We began with a simple Deep Set model (\ref{sec:DeepSet}) and, 
through a series of investigations, developed more complex architectures such as the Deep Set Combined model and the Deep Set Combined with GCN model.  
Our exploration culminated in a Transformer model and an ``Optimal Model'' configuration.


\begin{figure}[H]
 \centering
    \includegraphics[width=0.75\textwidth]{chapters/Results/ROC_curves.pdf}
    \caption{The resulting ROC curves of our different models}
    \label{fig:ROC_curves_results}
\end{figure}

From Figure~\ref{fig:ROC_curves_results}, it is evident that all but 
the simplest baseline models achieve strong results,  
with most AUC scores exceeding $0.85$, indicating strong classification performance.  
The Transformer and Optimal Model stand out with the highest AUC values.

While ROC curves indicate classification quality, they do not reflect entirely the impact
on computational efficiency. To address this, we also evaluate the \emph{speedup}—(\ref{sec:Speedup})
if events are filtered using the model predictions.

\begin{figure}[H]
 \centering
    \includegraphics[width=0.75\textwidth]{chapters/Results/Speedupt.pdf}
    \caption{Speedup gained by our seperate models}
    \label{fig:speedup}
\end{figure}

From figure  (fig \ref{fig:ROC_curves_results}), we observe that the
more advanced models are indistinguishable as far as their ROC performance is concerned,
however they diverge in the achievable speedup. 
The Optimal Model attains the highest maximum speedup, 
followed closely by the Transformer and Deep Set Combined with GCN variants.


\begin{table}[h]
    \centering
    \caption{Evaluation metrics for all models}
    \label{tab:model_summary}
    \begin{tabular}{l|c|c|c|c|c}
        \hline
        \textbf{Model} & \textbf{Loss} & \textbf{Acc. (\%)} & \textbf{AUC} & \textbf{Max. Speedup} & \textbf{Best Threshold} \\
        \hline
        DS & $0.633$ & $63.6$ & $0.699$ & $2.485$ & $0.618$ \\
        DS\_combined & $0.476$ & $77.5$ & $0.852$ & $4.758$ & $1.757$ \\
        DS\_gcn & $0.614$ & $66.0$ & $0.721$ & $2.795$ & $1.149$ \\
        DS\_combined\_wgcn & $0.464$ & $78.0$ & $0.862$ & $5.323$ & $1.586$ \\
        transformer & $0.441$ & $79.5$ & $0.872$ & $5.301$ & $1.774$ \\
        DS\_combined\_wgcn\_normalized & $0.702$ & $47.1$ & $0.517$ & $1.112$ & $-0.272$ \\
        optimal\_model & $0.432$ & $80.1$ & $0.880$ & $6.009$ & $1.899$ \\
        \hline
    \end{tabular}
\end{table}




The \emph{Best Threshold} column is obtained from the set 
of decision thresholds returned by the \verb|roc_curve| function.  
These thresholds correspond to decreasing cut values on 
the model’s decision function that are used to compute 
the true positive rate (TPR) and false positive rate (FPR) pairs.  
The first threshold is always set to \verb|np.inf|, 
which by definition yields zero predicted positives.  

Among these thresholds, the one shown in the table is 
the value at which the model 
achieves its maximum estimated speedup.  
For example, the Optimal Model reaches a 
maximum speedup of $5.934$ at a decision threshold of $1.901$.
